import HTTPSWarning from '/docs/hosting/_includes/warning/_https-url-change.mdx';
import CodeBlock from "/src/components/CodeBlock/CodeBlock";
import CertificateWarning from '/docs/hosting/_includes/warning/_passphrase-protected-private-key.mdx';

<HTTPSWarning />

## SSL configuration

Passbolt RPM packages currently supports the configuration of nginx. It comes with a default configuration that supports:

  -  Serve passbolt on port 80 (http)
  -  Serve passbolt on port 443 (https)

On this context ‘manually’ means that the user will provide the SSL certificates, this is the main difference with the ‘auto’ method where [Let’s Encrypt](https://letsencrypt.org/) will issue the SSL certificate for you.

This manual method is often useful on private network installations with private CA where the system admin issues a new private SSL certificate and uploads it to the passbolt server. It is also a method often used with self-signed SSL certificates for test installations.

On this example we will assume the user is generating a self-signed certificate on the passbolt server.


## Generate the SSL certificate

While connected to your passbolt instance you can generate a SSL certificate in the following way:
<CodeBlock>
{`openssl req -x509 \\
    -newkey rsa:4096 \\
    -days 120 \\
    -subj "/C=LU/ST=Luxembourg/L=Esch-Sur-Alzette/O=Passbolt SA/OU=Passbolt IT Team/CN=passbolt.domain.tld/" \\
    -nodes \\
    -addext "subjectAltName = DNS:passbolt.domain.tld" \\
    -keyout key.pem \\
    -out cert.pem`}
</CodeBlock>

This command will output two files: `key.pem` and `cert.pem`. Identify the absolute path where these files are located as you will need them in next steps.

Of course, replace `-subj` values with your own. It is important to set your passbolt FQDN in both `CN` and `subjectAltName`. In this way, you will be able to import the generated certificate in your operating system keychain and make your self-signed domain trusted in your browser.

:::important[Pro tip:]
You can use an IP address instead of a domain name for your self-signed certificate. If you do that, replace DNS with IP in `subjectAltName`.
:::

## Install or reconfigure passbolt

If you are reconfiguring passbolt you most likely want to say **‘NO’** to the mariadb or havaged setup questions and go for the nginx setup

Passbolt {props.productName} RPM package come with a configuration helper tool to prepare MariaDB, Nginx and SSL settings.

You must prepare your SSL certificates before launching the tool. Be sure to write down the full path to your cert/key combo, as it will be needed in the nginx configuration process.

Please, notice that for security matters we highly recommend to setup SSL to serve passbolt.

Launch passbolt-configure tool and answer to the questions:

<CodeBlock>
    {`sudo /usr/local/bin/passbolt-configure`}
</CodeBlock>

If you are reconfiguring passbolt you most likely want to say **‘NO’** to the mariadb or havaged setup questions and go for the nginx setup

<CodeBlock>
    {`
==============================================================
Do you want to install a local mariadb server on this machine?
==============================================================
1) yes
2) no
#? `}
</CodeBlock>

Please enter the domain name under which passbolt will run.

:::important[Note]
This hostname will be used as server_name for nginx and as the domain name to register a SSL certificate with let’s encrypt if you don’t have your own SSL certificates.
:::
<CodeBlock>
    {`=========
Hostname: passbolt.domain.tld
=========`}
</CodeBlock>

You will then be able to chosse the manual setup.

<CodeBlock>
    {`==================
Setting up SSL...
==================
1) manual
2) auto
3) none
#?`}
</CodeBlock>

If you choose 1, you will be prompted for the full path of your certificates:

<CertificateWarning />

<CodeBlock>
    {`Enter the path to the SSL certificate: /path/to/certs/cert.pem
Enter the path to the SSL privkey: /path/to/certs/key.pem`}
</CodeBlock>

Nginx and MariaDB are now on the way to be configured. You will be notified at the end of the process to connect to the Passbolt web interface to finish the configuration.

<CodeBlock>
    {`===============================================================
Installation is almost complete. Please point your browser to
  https://passbolt.domain.tld to complete the process
===============================================================`}
</CodeBlock>

Reload nginx once reconfiguration is complete to apply the SSL configuration.

<CodeBlock>
    {`sudo systemctl reload nginx`}
</CodeBlock>

:::warning
Finally, ensure `fullBaseUrl` value in `/etc/passbolt/passbolt.php` starts with `https://`.
:::

And that’s it you should be able to reach your server on the domain you specified.
