import Figure from '/src/components/Figure/Figure';
import GpgKeyGeneration from '/docs/hosting/_includes/warning/_gpg-key-generation.mdx';
import Counter from '/docs/components/counter';
import Link from '@docusaurus/Link';
import DigitalOceanSMTPWarning from '/docs/hosting/_includes/warning/_digital-ocean-smtp.mdx';

## 2. Configure Passbolt

Before you can use the application, you need to configure it. Point your browser to the hostname / IP where Passbolt
can be reached. You will reach a getting started page.

<Figure
  src="/img/help/2021/02/web-installer-getting-started.png"
  alt="Passbolt welcome page before configuration"
  caption="fig. Passbolt welcome page before configuration"
/>

<Counter chapter={2} resetCounter={true} title="Healthcheck" />

The first page of the wizard will tell you if your environment is ready for Passbolt. Solve issues if any and click on
"Start configuration" when ready.

<>
  {props.productLabel === 'CE' ? (
    <Figure
      src={
        '/img/help/2018/11/web-installer-ce-healthcheck.png'
      }
      alt={'Healthcheck from the wizard'}
      caption={'fig. Wizard - Healthcheck'}
    />
  ) : (
    <Figure
      src={
        '/img/help/2018/11/web-installer-pro-healthcheck.png'
      }
      alt={'Healthcheck from the wizard'}
      caption={'fig. Wizard - Healthcheck'}
    />
  )}
</>

<>
  {props.productLabel === 'PRO' && (
    <>
      <Counter chapter={2} title="Subscription Key" />
      <span>
        At this step, the wizard will ask you for your subscription key. You
        should have received it by email soon after your online purchase. Enter
        it in the box.
      </span>
      <Figure
        src={
          '/img/help/2018/11/web-installer-pro-subscription-key.png'
        }
        alt={'Subscription key from the wizard'}
        caption={'fig. Wizard - Subscription Key'}
      />
    </>
  )}
</>

<div>
  {props.distributionLabel === 'AWS AMI' ||
  props.distributionLabel === 'Virtual Appliance' ||
  props.distributionLabel === 'Digital Ocean' ? (
    <>
      <Counter chapter={2} title="Database" />
      <p>
        Passbolt {props.distributionLabel} comes with a preinstalled mariadb
        database. The credentials for this database are randomly generated on
        the first boot and the webinstaller autofills those credentials for you.
      </p>
      <p>
        The autogenerated database credentials will be available for later use
        by administrators in <code>/etc/passbolt/passbolt.php</code> file.
      </p>
      <p>
        If you decide to use the autogenerated credentials you can click the
        "Next" button and move to the next step on this tutorial.
      </p>
      {props.productLabel === 'CE' ? (
        <Figure
          src={
            '/img/help/2021/02/web-installer-ce-database.png'
          }
          alt={'Database from the wizard'}
          caption={'fig. Wizard - Database'}
        />
      ) : (
        <Figure
          src={
            '/img/help/2021/02/web-installer-pro-database.png'
          }
          alt={'Database from the wizard'}
          caption={'fig. Wizard - Database'}
        />
      )}
      <p>
        <b>Optional:</b> In case you do not want to use the autogenerated
        mariadb credentials you could connect through ssh to your instance and
        use the mariadb root credentials to create a new user, password and
        database for Passbolt to use:
      </p>
      <pre>
        <code className="language-bash">ssh admin@your_domain|instance_ip</code>
      </pre>
      <p>
        You can find the root database credentials in{' '}
        <code>/root/.mysql_credentials</code> file:
      </p>
      <pre>
        <code className="language-bash">sudo cat /root/.mysql_credentials</code>
      </pre>
      <p>
        Once you have the root database credentials you can connect to the local
        mariadb and create any database and user you want to use to install
        passbolt.
      </p>
    </>
  ) : (
    <>
      <Counter chapter={2} title="Database" />
      <p>
        This step is about telling Passbolt which database to use. Enter the
        host name, port number, database name, username and password.
      </p>
      {props.productLabel === 'CE' ? (
        <Figure
          src={
            '/img/help/2021/02/web-installer-ce-database.png'
          }
          alt={'Database from the wizard'}
          caption={'fig. Wizard - Database'}
        />
      ) : (
        <Figure
          src={
            '/img/help/2021/02/web-installer-pro-database.png'
          }
          alt={'Database from the wizard'}
          caption={'fig. Wizard - Database'}
        />
      )}
    </>
  )}
</div>

<Counter chapter={2} title="GPG Key" />

In this section you can either generate or import a GPG key pair. This key pair will be used by Passbolt API to authenticate itself during the login handshake process.
Generate a key if you don't have one.

<>
  {props.productLabel === 'CE' ? (
    <Figure
      src={
        '/img/help/2018/11/web-installer-ce-server-key-generate.png'
      }
      alt={'GPG Key from the wizard'}
      caption={'fig. Wizard - Gpg Key'}
    />
  ) : (
    <Figure
      src={
        '/img/help/2018/11/web-installer-pro-server-key-generate.png'
      }
      alt={'GPG Key from the wizard'}
      caption={'fig. Wizard - Gpg Key'}
    />
  )}
</>

:::tip[Optional]
Import a key if you already have one and you want your server to use it.
:::

<GpgKeyGeneration />

<>
  {props.productLabel === 'CE' ? (
    <Figure
      src={
        '/img/help/2018/11/web-installer-ce-server-key-import.png'
      }
      alt={'Import a Key Pair from the Wizard'}
      caption={'fig. Wizard - Import a Key Pair'}
    />
  ) : (
    <Figure
      src={
        '/img/help/2018/11/web-installer-pro-server-key-import.png'
      }
      alt={'Import a Key Pair from the Wizard'}
      caption={'fig. Wizard - Import a Key Pair'}
    />
  )}
</>

<Counter chapter={2} title="Mail Server (SMTP)" />

<>
  {props.distributionLabel === 'Digital Ocean' && (
    <DigitalOceanSMTPWarning />
  )}
</>

At this stage, the wizard will ask you to enter the details of your SMTP server.

<>
  {props.productLabel === 'CE' ? (
    <Figure
      src={
        '/img/help/2018/11/web-installer-ce-email.png'
      }
      alt={'SMTP details from the Wizard'}
      caption={'fig. Wizard -  SMTP Mail Server Details'}
    />
  ) : (
    <Figure
      src={
        '/img/help/2018/11/web-installer-pro-email.png'
      }
      alt={'SMTP details from the Wizard'}
      caption={'fig. Wizard - SMTP Mail Server Details'}
    />
  )}
</>

You can also test that your configuration is correct by using the test email feature at the right of your screen. Enter the email address at which you want the wizard to send you a test email and click on "Send test email".

<Figure
  src={
    '/img/help/2018/04/wizard-test-email.png'
  }
  alt={'Test smtp settings from the Wizard'}
  caption={'fig. Wizard - Test SMTP Settings'}
  size={{ width: '512px', height: 'auto' }}
/>

<Counter chapter={2} title="Preferences" />

The wizard will then ask you what preferences you prefer for your instance of Passbolt. The recommended defaults are already pre-populated but you can also change them if you know what you are doing.

<>
  {props.productLabel === 'CE' ? (
    <Figure
      src={
        '/img/help/2018/11/web-installer-ce-options.png'
      }
      alt={'Preferences from the Wizard'}
      caption={'fig. Wizard -  Preferences'}
    />
  ) : (
    <Figure
      src={
        '/img/help/2018/11/web-installer-pro-options.png'
      }
      alt={'Preferences from the Wizard'}
      caption={'fig. Wizard - Preferences'}
    />
  )}
</>

<Counter chapter={2} title="First User Creation" />

You need to create the first admin user account. This first admin user is probably you, so enter your details and click on next.

<>
  {props.productLabel === 'CE' ? (
    <Figure
      src={
        '/img/help/2018/11/web-installer-ce-first-user.png'
      }
      alt={'First user creation from the Wizard'}
      caption={'fig. Wizard -  First user creation'}
    />
  ) : (
    <Figure
      src={
        '/img/help/2018/11/web-installer-pro-first-user.png'
      }
      alt={'First user creation from the Wizard'}
      caption={'fig. Wizard - First user creation'}
    />
  )}
</>

<Counter chapter={2} title="Installation" />

That's it. The wizard has now enough information to proceed with the configuration of Passbolt. Sit back and relax for a few seconds while the configuration process is going on.

<>
  {props.productLabel === 'CE' ? (
    <Figure
      src={
        '/img/help/2018/11/web-installer-ce-install.png'
      }
      alt={'Installation from the Wizard'}
      caption={'fig. Wizard -  Installation'}
    />
  ) : (
    <Figure
      src={
        '/img/help/2018/11/web-installer-pro-install.png'
      }
      alt={'Installation from the Wizard'}
      caption={'fig. Wizard - Installation'}
    />
  )}
</>

Your user account is now created. You will see a redirection page for a few second and then will be redirected to the user setup process so that you can configure your user account.

<>
  {props.productLabel === 'CE' ? (
    <Figure
      src={
        '/img/help/2018/11/web-installer-ce-completed.png'
      }
      alt={'Completion and redirection from the Wizard'}
      caption={'fig. Wizard -  Completion and Redirection'}
    />
  ) : (
    <Figure
      src={
        '/img/help/2018/11/web-installer-pro-completed.png'
      }
      alt={'Completion and redirection from the Wizard'}
      caption={'fig. Wizard - Completion and Redirection'}
    />
  )}
</>
<Counter chapter={2} title="HTTPS setup process" />

  <>
    {(() => {
      switch (props.distributionLabel) {
        case 'Virtual Appliance':
          return (
            <p>Passbolt Pro VM uses Passbolt Debian package. Depending on your needs there are two different options to setup nginx and SSL using the Debian package:</p>
          );
        case 'Digital Ocean':
          return (
            <p>Passbolt Digital Ocean uses Passbolt Ubuntu package. Depending on your needs there are two different options to setup nginx and SSL using the Ubuntu package:</p>
          );
        case 'Ubuntu':
          return (
            <p>Passbolt uses Passbolt Ubuntu package. Depending on your needs there are two different options to setup nginx and SSL using the Ubuntu package:</p>
          );
        case 'Debian':
          return (
            <p>Passbolt uses Passbolt Debian package. Depending on your needs there are two different options to setup nginx and SSL using the Debian package:</p>
          );
        default:
          return (
            <p>Depending on your needs there are two different options to setup nginx and SSL using the package:</p>
          );
      }
    })()}
  </>


<div>
    <ul>
        <li>
            <Link to={`/docs/hosting/configure/https/${props.productLabel.toLowerCase()}/debian-auto/`}>
              Auto (Using Let's Encrypt)
            </Link>
        </li>
        <li>
            <Link to={`/docs/hosting/configure/https/${props.productLabel.toLowerCase()}/debian-manual`}>
              Manual (Using user-provided SSL certificates)
            </Link>
        </li>
    </ul>
</div>
